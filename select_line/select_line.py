#coding=utf-8

import os
import sys
import ctypes
##import sub_func
#from sub_func import *

def select_line() :

	##	-------------------------------------------------------------------------------------
	##	调试开关
	##	-------------------------------------------------------------------------------------
	debug = 0;

	for i in range(0,len(sys.argv)):
		if(sys.argv[i]=="-d"):
			debug = 1;
			break;
#	debug = 1;
	print("debug is ",debug);

	##	===============================================================================================
	##	ref ***源文件操作***
	##	===============================================================================================
	##	-------------------------------------------------------------------------------------
	##	获取输入文件
	##	-------------------------------------------------------------------------------------
	src_path = sys.argv[1];
	if(debug==1):	print("src_path is",src_path);

	##	-------------------------------------------------------------------------------------
	##	判断输入的是否是一个文件
	##	--如果不是文件，打印错误，退出
	##	--如果是一个文件，打开文件
	##	-------------------------------------------------------------------------------------
	if(os.path.isfile(src_path)==False):	return -1
	if(debug==1):	print("src_path is really exist");
	infile	= open(src_path,"r")

	##	-------------------------------------------------------------------------------------
	##	记录文件总行数
	##	-------------------------------------------------------------------------------------
	file_content = infile.readlines();
	line_num = len(file_content);
	if(debug==1):	print("all line num is ",line_num);

	##	===============================================================================================
	##	ref ***找到pattern***
	##	===============================================================================================
	pattern1 = sys.argv[2];
	pattern2 = sys.argv[3];

	##	===============================================================================================
	##	ref ***读文件 找关键字***
	##	===============================================================================================
	##	-------------------------------------------------------------------------------------
	##	如果 pattern1找到了，那么再找 pattern2 如果能找到，说明没有问题
	##	-------------------------------------------------------------------------------------
	list_parser = [];
	for i in range(0,line_num):
		line_content	= file_content[i];
		##	-------------------------------------------------------------------------------------
		##	在每一行中找 pattern1
		##	-------------------------------------------------------------------------------------
		if(line_content.find(pattern1)>=0):
			if(debug==1):	print("******find pattern1 line num is ",i);
			##	-------------------------------------------------------------------------------------
			##	在每一行中找 pattern2，如果不包含pattern2，那么就可以添加
			##	-------------------------------------------------------------------------------------
			if (line_content.find(pattern2)<0):
				list_parser.append(line_content);

	##	===============================================================================================
	##	ref ***输出文件***
	##	===============================================================================================
	##	-------------------------------------------------------------------------------------
	##	从源文件的路径得到目的文件路径
	##	--解析后的文件名字是"select_line.txt"
	##	-------------------------------------------------------------------------------------
	temp = os.path.split(src_path);
	only_path = temp[0];
	temp = os.path.basename(src_path);
	temp = temp.split('.');
	only_name = temp[0];
	path = only_path+'\\'+only_name+"_select_line.txt";


	##	-------------------------------------------------------------------------------------
	##	建立新的文件
	##	-------------------------------------------------------------------------------------
	outfile_summary = open(path,"w+");

	##	-------------------------------------------------------------------------------------
	##	建立新的文件
	##	-------------------------------------------------------------------------------------
	for eachline in list_parser:
		outfile_summary.write(str(eachline));

	##	===============================================================================================
	##	ref ***结束***
	##	===============================================================================================
	outfile_summary.close()
	infile.close()

select_line()


